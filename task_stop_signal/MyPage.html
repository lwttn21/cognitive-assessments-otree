{% extends "global/Page.html" %}
{% load otree static %}

{% block content %}

<style>
.otree-timer {
    display: none !important;
}
</style>

<div style="width: 300px; height: 300px; margin: 120px auto; border: 6px solid black; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;">

    <div id="arrow" style="font-size: 160px; visibility: hidden;">
        {% if arrow == 'left' %}
            ←
        {% else %}
            →
        {% endif %}
    </div>



<audio id="beep" preload="auto">
    <source src="{% static 'task_stop_signal/beep.wav' %}" type="audio/wav">
</audio>


<script>
let responded = false;
let startTime = null;
const stopSignalDelay = 250; // typically around 250ms after the arrow

let isStopTrial = {{ stop_signal|json }};

// Show first arrow right after the offset
window.onload = function() {
    const arrowDiv = document.getElementById('arrow');

    // show arrow
    arrowDiv.style.visibility = 'visible';
    startTime = performance.now();

    // second Stop Signal after the arrow (SSD)
    if (isStopTrial) {
        setTimeout(function() {
            // Only play if the user has not already reacted
            if (!responded) {
                document.getElementById('beep').play();
            }
        }, stopSignalDelay);
    }
};

document.addEventListener('keydown', function(event) {
    if (responded) return;
    let key = event.key.toLowerCase();
    if (key !== 'f' && key !== 'j') return;
    if (startTime === null) return;

    responded = true;
    let rt = performance.now() - startTime;

    liveSend({
        key: key,
        rt: rt
    });

    // Visual feedback: remove arrow after reaction
    document.getElementById('arrow').style.visibility = 'hidden';
});
</script>

{% endblock %}